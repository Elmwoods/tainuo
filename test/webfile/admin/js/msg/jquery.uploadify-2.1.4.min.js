if(jQuery)(function(s){s.extend(s.fn,{uploadify:function(r){s(this).each(function(){var l=s.extend({id:s(this).attr('id'),uploader:'uploadify.swf',script:'uploadify.php',expressInstall:null,folder:'',height:30,width:120,cancelImg:'cancel.png',wmode:'opaque',scriptAccess:'sameDomain',fileDataName:'Filedata',method:'POST',queueSizeLimit:999,simUploadLimit:1,showSumm:false,summText:"描述",defaultSumm:false,queueID:false,displayData:'percentage',removeCompleted:true,onInit:function(){},onSelect:function(){},onSelectOnce:function(){},onQueueFull:function(){},onCheck:function(){},onCancel:function(){},onClearQueue:function(){},onError:function(){},onProgress:function(){},onComplete:function(){},onAllComplete:function(){}},r);s(this).data('settings',l);var m=location.pathname;m=m.split('/');m.pop();m=m.join('/')+'/';var n={};n.uploadifyID=l.id;n.pagepath=m;if(l.buttonImg)n.buttonImg=escape(l.buttonImg);if(l.buttonText)n.buttonText=encodeURI(l.buttonText);if(l.rollover)n.rollover=true;n.script=l.script;n.folder=escape(l.folder);n.summText=l.summText;if(l.scriptData){var o='';for(var p in l.scriptData){o+='&'+p+'='+l.scriptData[p]}n.scriptData=escape(o.substr(1))}if(l.defaultSumm==true||typeof(l.defaultSumm)=="string"){n.getDefaultSumm=l.defaultSumm}else{n.getDefaultSumm=false}n.showSumm=(l.showSumm?true:false);n.width=l.width;n.height=l.height;n.wmode=l.wmode;n.method=l.method;n.queueSizeLimit=l.queueSizeLimit;n.simUploadLimit=l.simUploadLimit;if(l.hideButton)n.hideButton=true;if(l.fileDesc)n.fileDesc=l.fileDesc;if(l.fileExt)n.fileExt=l.fileExt;if(l.multi)n.multi=true;if(l.auto)n.auto=true;if(l.sizeLimit)n.sizeLimit=l.sizeLimit;if(l.checkScript)n.checkScript=l.checkScript;if(l.fileDataName)n.fileDataName=l.fileDataName;if(l.queueID)n.queueID=l.queueID;if(l.onInit()!==false){s(this).css('display','none');s(this).after('<div id="'+s(this).attr('id')+'Uploader"></div>');swfobject.embedSWF(l.uploader,l.id+'Uploader',l.width,l.height,'9.0.24',l.expressInstall,n,{'quality':'high','wmode':l.wmode,'allowScriptAccess':l.scriptAccess},{},function(a){if(typeof(l.onSWFReady)=='function'&&a.success)l.onSWFReady()});if(l.queueID==false){s("#"+s(this).attr('id')+"Uploader").after('<div id="'+s(this).attr('id')+'Queue" class="uploadifyQueue"></div>')}else{s("#"+l.queueID).addClass('uploadifyQueue')}}if(typeof(l.onOpen)=='function'){s(this).bind("uploadifyOpen",l.onOpen)}s(this).bind("uploadifySelect",{'action':l.onSelect,'queueID':l.queueID},function(a,b,c){if(a.data.action(a,b,c)!==false){var d=Math.round(c.size/1024*100)*.01;var e='KB';if(d>1000){d=Math.round(d*.001*100)*.01;e='MB'}var f=d.toString().split('.');if(f.length>1){d=f[0]+'.'+f[1].substr(0,2)}else{d=f[0]}if(c.name.length>20){fileName=c.name.substr(0,20)+'...'}else{fileName=c.name}queue='#'+s(this).attr('id')+'Queue';if(a.data.queueID){queue='#'+a.data.queueID}var g="";if(n.showSumm){var h="";if(n.getDefaultSumm==true){h=c.name.substring(0,fileName.lastIndexOf("."))}else if(typeof(n.getDefaultSumm).toLowerCase()=="string"){h=n.getDefaultSumm}g='<div class="uploadifyFileSummary">'+'<span>'+n.summText+'：</span>'+'<input type="text" id="txt'+s(this).attr('id')+b+'FileSummary" value="'+h.replace(/'/g,"\\'")+'" />'+'</div>'}s(queue).append('<div id="'+s(this).attr('id')+b+'" class="uploadifyQueueItem">'+'<div class="cancel">'+'<a href="javascript:jQuery(\'#'+s(this).attr('id')+'\').uploadifyCancel(\''+b+'\')"><img src="'+l.cancelImg+'" border="0" /></a>'+'</div>'+'<span class="fileName">'+fileName+' ('+d+e+')</span><span class="percentage"></span>'+'<div class="uploadifyProgress">'+'<div id="'+s(this).attr('id')+b+'ProgressBar" class="uploadifyProgressBar"><!--Progress Bar--></div>'+'</div>'+g+'<div>'+'</div>')}});s(this).bind("uploadifySelectOnce",{'action':l.onSelectOnce},function(a,b){a.data.action(a,b);if(l.auto){if(l.checkScript){s(this).uploadifyUpload(null,false,l.queueID)}else{s(this).uploadifyUpload(null,true,l.queueID)}}});s(this).bind("uploadifyQueueFull",{'action':l.onQueueFull},function(a,b){if(a.data.action(a,b)!==false){alert('The queue is full.  The max size is '+b+'.')}});s(this).bind("uploadifyCheckExist",{'action':l.onCheck},function(d,e,f,g,h){var i=new Object();i=f;i.folder=(g.substr(0,1)=='/')?g:m+g;if(h){for(var j in f){var k=j}}s.post(e,i,function(a){for(var b in a){if(d.data.action(d,a,b)!==false){var c=confirm("Do you want to replace the file "+a[b]+"?");if(!c){document.getElementById(s(d.target).attr('id')+'Uploader').cancelFileUpload(b,true,true)}}}if(h){document.getElementById(s(d.target).attr('id')+'Uploader').startFileUpload(k,true)}else{document.getElementById(s(d.target).attr('id')+'Uploader').startFileUpload(null,true)}},"json")});s(this).bind("uploadifyCancel",{'action':l.onCancel},function(a,b,c,d,e,f){if(a.data.action(a,b,c,d,f)!==false){if(e){var g=(f==true)?0:250;s("#"+s(this).attr('id')+b).fadeOut(g,function(){s(this).remove()})}}});s(this).bind("uploadifyClearQueue",{'action':l.onClearQueue},function(b,c){var d=(l.queueID)?l.queueID:s(this).attr('id')+'Queue';if(c){s("#"+d).find('.uploadifyQueueItem').remove()}if(b.data.action(b,c)!==false){s("#"+d).find('.uploadifyQueueItem').each(function(){var a=s('.uploadifyQueueItem').index(this);s(this).delay(a*100).fadeOut(250,function(){s(this).remove()})})}});var q=[];s(this).bind("uploadifyError",{'action':l.onError},function(a,b,c,d){if(a.data.action(a,b,c,d)!==false){var e=new Array(b,c,d);q.push(e);s("#"+s(this).attr('id')+b).find('.percentage').text(" - "+d.type+" Error");s("#"+s(this).attr('id')+b).find('.uploadifyProgress').hide();s("#"+s(this).attr('id')+b).addClass('uploadifyError')}});if(typeof(l.onUpload)=='function'){s(this).bind("uploadifyUpload",l.onUpload)}s(this).bind("uploadifyProgress",{'action':l.onProgress,'toDisplay':l.displayData},function(a,b,c,d){if(a.data.action(a,b,c,d)!==false){s("#"+s(this).attr('id')+b+"ProgressBar").animate({'width':d.percentage+'%'},250,function(){if(d.percentage==100){s(this).closest('.uploadifyProgress').fadeOut(250,function(){s(this).remove()})}});if(a.data.toDisplay=='percentage')displayData=' - '+d.percentage+'%';if(a.data.toDisplay=='speed')displayData=' - '+d.speed+'KB/s';if(a.data.toDisplay==null)displayData=' ';s("#"+s(this).attr('id')+b).find('.percentage').text(displayData)}});s(this).bind("uploadifyComplete",{'action':l.onComplete},function(a,b,c,d,e){if(a.data.action(a,b,c,unescape(d),e)!==false){s("#"+s(this).attr('id')+b).find('.percentage').text(' - 上传完成!');if(l.removeCompleted){s("#"+s(a.target).attr('id')+b).fadeOut(250,function(){s(this).remove()})}s("#"+s(a.target).attr('id')+b).addClass('completed')}});if(typeof(l.onAllComplete)=='function'){s(this).bind("uploadifyAllComplete",{'action':l.onAllComplete},function(a,b){if(a.data.action(a,b)!==false){q=[]}})}})},uploadifySettings:function(d,e,f){var g=false;s(this).each(function(){if(d=='scriptData'&&e!=null){if(f){var a=e}else{var a=s.extend(s(this).data('settings').scriptData,e)}var b='';for(var c in a){b+='&'+c+'='+a[c]}e=escape(b.substr(1))}g=document.getElementById(s(this).attr('id')+'Uploader').updateSettings(d,e)});if(e==null){if(d=='scriptData'){var h=unescape(g).split('&');var j=new Object();for(var i=0;i<h.length;i++){var k=h[i].split('=');j[k[0]]=k[1]}g=j}}return g},uploadifyUpload:function(b,c,d){var e=s(this);var f=e.attr('id');var g=e.data("settings");if(g.showSumm){var h="";var i="";var j="";$("#"+g.queueID).children().each(function(a){h=/[A-Z]{6}$/.exec(s(this).attr('id'))[0];i=$("#txt"+f+h+"FileSummary").val();j+="\""+h+"\":\""+escape(i)+"\","});j="{"+j.substring(0,j.length-1)+"}";document.getElementById(f+'Uploader').pushSummary(j)}s(this).each(function(){if(!c)c=false;document.getElementById(f+'Uploader').startFileUpload(b,c)})},uploadifyCancel:function(a){s(this).each(function(){document.getElementById(s(this).attr('id')+'Uploader').cancelFileUpload(a,true,true,false)})},uploadifyClearQueue:function(){s(this).each(function(){document.getElementById(s(this).attr('id')+'Uploader').clearFileUploadQueue(false)})}})})(jQuery);